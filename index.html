<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BizzWA - WhatsApp CRM Dashboard</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }
        .chat-container {
            height: calc(100vh - 300px);
            min-height: 400px;
        }
        .tag-badge {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, createContext, useContext, useEffect, useRef } = React;

        // Mock data with customer history
        const mockConversations = [
            { 
                id: 1, 
                name: "Rajesh Kumar", 
                number: "+91 98765 43210", 
                lastMessage: "When will my order arrive?", 
                category: "Orders", 
                timestamp: "2 min ago", 
                aiReplied: true, 
                status: "pending",
                tags: ["Urgent"],
                customerHistory: {
                    totalOrders: 5,
                    totalSpent: "₹12,450",
                    complaints: 0,
                    joinedDate: "Jan 2024"
                },
                notes: [],
                chat: [
                    { sender: "customer", message: "Hi, I placed an order yesterday", time: "10:30 AM" },
                    { sender: "ai", message: "Hello! Thanks for reaching out. Let me check your order status.", time: "10:31 AM" },
                    { sender: "customer", message: "When will my order arrive?", time: "10:32 AM" }
                ]
            },
            { 
                id: 2, 
                name: "Priya Sharma", 
                number: "+91 98765 43211", 
                lastMessage: "I need help with installation", 
                category: "Inquiries", 
                timestamp: "15 min ago", 
                aiReplied: false, 
                status: "replied",
                tags: ["Follow-up"],
                customerHistory: {
                    totalOrders: 2,
                    totalSpent: "₹4,200",
                    complaints: 0,
                    joinedDate: "Mar 2024"
                },
                notes: [],
                chat: [
                    { sender: "customer", message: "I need help with installation", time: "9:45 AM" },
                    { sender: "business", message: "Sure! I'll guide you through the process.", time: "9:50 AM" }
                ]
            },
            { 
                id: 3, 
                name: "Amit Patel", 
                number: "+91 98765 43212", 
                lastMessage: "Product quality is not good", 
                category: "Complaints", 
                timestamp: "1 hour ago", 
                aiReplied: true, 
                status: "pending",
                tags: ["VIP Customer", "Urgent"],
                customerHistory: {
                    totalOrders: 12,
                    totalSpent: "₹28,900",
                    complaints: 1,
                    joinedDate: "Oct 2023"
                },
                notes: [],
                chat: [
                    { sender: "customer", message: "Product quality is not good", time: "8:30 AM" },
                    { sender: "ai", message: "We're sorry to hear that. Can you please share more details?", time: "8:31 AM" }
                ]
            },
            { 
                id: 4, 
                name: "Sneha Reddy", 
                number: "+91 98765 43213", 
                lastMessage: "Do you have this in blue?", 
                category: "Inquiries", 
                timestamp: "3 hours ago", 
                aiReplied: true, 
                status: "replied",
                tags: [],
                customerHistory: {
                    totalOrders: 1,
                    totalSpent: "₹1,850",
                    complaints: 0,
                    joinedDate: "Sep 2024"
                },
                notes: [],
                chat: [
                    { sender: "customer", message: "Do you have this in blue?", time: "7:15 AM" },
                    { sender: "ai", message: "Yes! We have that available in blue. Would you like to place an order?", time: "7:16 AM" },
                    { sender: "customer", message: "Yes please!", time: "7:17 AM" }
                ]
            },
            { 
                id: 5, 
                name: "Vikram Singh", 
                number: "+91 98765 43214", 
                lastMessage: "I want to place a bulk order", 
                category: "Orders", 
                timestamp: "5 hours ago", 
                aiReplied: false, 
                status: "pending",
                tags: ["VIP Customer"],
                customerHistory: {
                    totalOrders: 8,
                    totalSpent: "₹45,600",
                    complaints: 0,
                    joinedDate: "Dec 2023"
                },
                notes: [],
                chat: [
                    { sender: "customer", message: "I want to place a bulk order", time: "5:00 AM" }
                ]
            },
        ];

        // Auth Context
        const AuthContext = createContext();
        const AppContext = createContext();

        const AuthProvider = ({ children }) => {
            const [authState, setAuthState] = useState(null);
            const [userData, setUserData] = useState({});
            return (
                <AuthContext.Provider value={{ authState, setAuthState, userData, setUserData }}>
                    {children}
                </AuthContext.Provider>
            );
        };

        const AppProvider = ({ children }) => {
            const [activeScreen, setActiveScreen] = useState('dashboard');
            const [autoReply, setAutoReply] = useState(true);
            const [selectedConversation, setSelectedConversation] = useState(null);
            const [conversations, setConversations] = useState(mockConversations);
            const [searchQuery, setSearchQuery] = useState('');
            
            return (
                <AppContext.Provider value={{ 
                    activeScreen, 
                    setActiveScreen, 
                    autoReply, 
                    setAutoReply,
                    selectedConversation,
                    setSelectedConversation,
                    conversations,
                    setConversations,
                    searchQuery,
                    setSearchQuery
                }}>
                    {children}
                </AppContext.Provider>
            );
        };

        // Login/Signup Screen
        const LoginScreen = () => {
            const { setAuthState } = useContext(AuthContext);
            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                setAuthState('onboarding');
            };

            return (
                <div className="min-h-screen gradient-bg flex items-center justify-center px-4">
                    <div className="bg-slate-800 rounded-2xl shadow-2xl p-8 w-full max-w-md border border-slate-700">
                        <div className="text-center mb-8">
                            <div className="flex items-center justify-center mb-4">
                                <i className="fab fa-whatsapp text-teal-400 text-5xl"></i>
                            </div>
                            <h1 className="text-3xl font-bold text-white mb-2">BizzWA</h1>
                            <p className="text-gray-400">Your AI-powered WhatsApp CRM</p>
                        </div>

                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label className="block text-gray-300 text-sm font-medium mb-2">Email</label>
                                <input 
                                    type="email" 
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white"
                                    placeholder="you@example.com"
                                    required
                                />
                            </div>

                            <div className="mb-6">
                                <label className="block text-gray-300 text-sm font-medium mb-2">Password</label>
                                <input 
                                    type="password" 
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white"
                                    placeholder="••••••••"
                                    required
                                />
                            </div>

                            <button 
                                type="submit"
                                className="w-full bg-teal-500 hover:bg-teal-600 text-white font-semibold py-3 rounded-lg transition duration-200 mb-4"
                            >
                                {isLogin ? 'Login' : 'Sign Up'}
                            </button>

                            <div className="text-center">
                                <a href="#" className="text-teal-400 text-sm hover:underline">Forgot password?</a>
                            </div>

                            <div className="mt-6 text-center">
                                <span className="text-gray-400 text-sm">
                                    {isLogin ? "Don't have an account? " : "Already have an account? "}
                                </span>
                                <button 
                                    type="button"
                                    onClick={() => setIsLogin(!isLogin)}
                                    className="text-teal-400 text-sm font-medium hover:underline"
                                >
                                    {isLogin ? 'Sign Up' : 'Login'}
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Onboarding Screen
        const OnboardingScreen = () => {
            const { setAuthState, setUserData } = useContext(AuthContext);
            const [formData, setFormData] = useState({
                businessName: '',
                ownerName: '',
                category: 'Retail',
                language: 'English',
                whatsappNumber: ''
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                setUserData(formData);
                setAuthState('loggedIn');
            };

            return (
                <div className="min-h-screen gradient-bg flex items-center justify-center px-4 py-8">
                    <div className="bg-slate-800 rounded-2xl shadow-2xl p-8 w-full max-w-xl border border-slate-700">
                        <div className="text-center mb-8">
                            <i className="fas fa-user-circle text-teal-400 text-5xl mb-4"></i>
                            <h2 className="text-2xl font-bold text-white mb-2">Complete Your Profile</h2>
                            <p className="text-gray-400">Tell us about your business</p>
                        </div>

                        <form onSubmit={handleSubmit}>
                            <div className="mb-4">
                                <label className="block text-gray-300 text-sm font-medium mb-2">Business Name</label>
                                <input 
                                    type="text" 
                                    value={formData.businessName}
                                    onChange={(e) => setFormData({...formData, businessName: e.target.value})}
                                    className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white"
                                    placeholder="Your Business Name"
                                    required
                                />
                            </div>

                            <div className="mb-4">
                                <label className="block text-gray-300 text-sm font-medium mb-2">Owner Name</label>
                                <input 
                                    type="text" 
                                    value={formData.ownerName}
                                    onChange={(e) => setFormData({...formData, ownerName: e.target.value})}
                                    className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white"
                                    placeholder="Your Name"
                                    required
                                />
                            </div>

                            <div className="mb-4">
                                <label className="block text-gray-300 text-sm font-medium mb-2">Category</label>
                                <select 
                                    value={formData.category}
                                    onChange={(e) => setFormData({...formData, category: e.target.value})}
                                    className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white"
                                >
                                    <option>Retail</option>
                                    <option>Services</option>
                                    <option>Food & Beverage</option>
                                    <option>Other</option>
                                </select>
                            </div>

                            <div className="mb-4">
                                <label className="block text-gray-300 text-sm font-medium mb-2">Preferred Language</label>
                                <select 
                                    value={formData.language}
                                    onChange={(e) => setFormData({...formData, language: e.target.value})}
                                    className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white"
                                >
                                    <option>English</option>
                                    <option>Hindi</option>
                                </select>
                            </div>

                            <div className="mb-6">
                                <label className="block text-gray-300 text-sm font-medium mb-2">WhatsApp Number</label>
                                <input 
                                    type="tel" 
                                    value={formData.whatsappNumber}
                                    onChange={(e) => setFormData({...formData, whatsappNumber: e.target.value})}
                                    className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white"
                                    placeholder="+91 98765 43210"
                                    required
                                />
                            </div>

                            <button 
                                type="submit"
                                className="w-full bg-teal-500 hover:bg-teal-600 text-white font-semibold py-3 rounded-lg transition duration-200"
                            >
                                Continue to Dashboard
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // Header Component
        const Header = () => {
            const { autoReply, setAutoReply } = useContext(AppContext);
            const { setAuthState } = useContext(AuthContext);
            const [showDropdown, setShowDropdown] = useState(false);

            return (
                <header className="bg-slate-800 border-b border-slate-700 px-4 lg:px-6 py-4">
                    <div className="flex items-center justify-between">
                        <h1 className="text-xl font-bold text-white lg:hidden">BizzWA</h1>
                        
                        <div className="flex items-center space-x-4 ml-auto">
                            <div className="flex items-center space-x-3 bg-slate-700 px-4 py-2 rounded-lg">
                                <span className="text-sm text-gray-300">Auto-Reply</span>
                                <button 
                                    onClick={() => setAutoReply(!autoReply)}
                                    className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${autoReply ? 'bg-teal-500' : 'bg-gray-600'}`}
                                >
                                    <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${autoReply ? 'translate-x-6' : 'translate-x-1'}`} />
                                </button>
                            </div>

                            <div className="relative">
                                <button 
                                    onMouseEnter={() => setShowDropdown(true)}
                                    onMouseLeave={() => setShowDropdown(false)}
                                    className="w-10 h-10 rounded-full bg-teal-500 flex items-center justify-center text-white font-semibold hover:bg-teal-600 transition"
                                >
                                    <i className="fas fa-user"></i>
                                </button>

                                {showDropdown && (
                                    <div 
                                        onMouseEnter={() => setShowDropdown(true)}
                                        onMouseLeave={() => setShowDropdown(false)}
                                        className="absolute right-0 mt-2 w-48 bg-slate-700 rounded-lg shadow-xl border border-slate-600 py-2 z-50"
                                    >
                                        <a href="#" className="block px-4 py-2 text-sm text-gray-300 hover:bg-slate-600">
                                            <i className="fas fa-cog mr-2"></i>Profile & Settings
                                        </a>
                                        <button 
                                            onClick={() => setAuthState(null)}
                                            className="block w-full text-left px-4 py-2 text-sm text-gray-300 hover:bg-slate-600"
                                        >
                                            <i className="fas fa-sign-out-alt mr-2"></i>Logout
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </header>
            );
        };

        // Sidebar Component
        const Sidebar = () => {
            const { activeScreen, setActiveScreen } = useContext(AppContext);
            const { setAuthState } = useContext(AuthContext);

            const NavButton = ({ screen, icon, label }) => (
                <button
                    onClick={() => setActiveScreen(screen)}
                    className={`w-full flex items-center space-x-3 px-4 py-3 rounded-lg transition ${
                        activeScreen === screen 
                            ? 'bg-teal-500 text-white' 
                            : 'text-gray-400 hover:bg-slate-700 hover:text-white'
                    }`}
                >
                    <i className={`${icon} text-lg`}></i>
                    <span className="font-medium">{label}</span>
                </button>
            );

            return (
                <aside className="hidden lg:flex flex-col w-64 bg-slate-800 border-r border-slate-700 h-screen fixed left-0 top-0">
                    <div className="p-6 border-b border-slate-700">
                        <div className="flex items-center space-x-2">
                            <i className="fab fa-whatsapp text-teal-400 text-3xl"></i>
                            <span className="text-2xl font-bold text-white">BizzWA</span>
                        </div>
                    </div>

                    <nav className="flex-1 p-4 space-y-2">
                        <NavButton screen="dashboard" icon="fas fa-th-large" label="Dashboard" />
                        <NavButton screen="analytics" icon="fas fa-chart-line" label="Analytics" />
                        <NavButton screen="settings" icon="fas fa-cog" label="Settings" />
                    </nav>

                    <div className="p-4 border-t border-slate-700">
                        <button 
                            onClick={() => setAuthState(null)}
                            className="w-full flex items-center space-x-3 px-4 py-3 text-gray-400 hover:bg-slate-700 hover:text-white rounded-lg transition"
                        >
                            <i className="fas fa-sign-out-alt text-lg"></i>
                            <span className="font-medium">Logout</span>
                        </button>
                    </div>
                </aside>
            );
        };

        // Bottom Navigation (Mobile)
        const BottomNav = () => {
            const { activeScreen, setActiveScreen } = useContext(AppContext);

            const NavButton = ({ screen, icon, label }) => (
                <button
                    onClick={() => setActiveScreen(screen)}
                    className={`flex flex-col items-center justify-center py-2 transition ${
                        activeScreen === screen ? 'text-teal-400' : 'text-gray-400'
                    }`}
                >
                    <i className={`${icon} text-xl mb-1`}></i>
                    <span className="text-xs">{label}</span>
                </button>
            );

            return (
                <nav className="lg:hidden fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 px-4 py-2 z-50">
                    <div className="flex justify-around">
                        <NavButton screen="dashboard" icon="fas fa-th-large" label="Dashboard" />
                        <NavButton screen="analytics" icon="fas fa-chart-line" label="Analytics" />
                        <NavButton screen="settings" icon="fas fa-cog" label="Settings" />
                    </div>
                </nav>
            );
        };

        // Customer History Component
        const CustomerHistory = ({ history }) => {
            return (
                <div className="bg-slate-700 rounded-lg p-4 mb-4">
                    <h4 className="text-sm font-semibold text-white mb-3 flex items-center">
                        <i className="fas fa-history mr-2 text-teal-400"></i>
                        Customer History
                    </h4>
                    <div className="grid grid-cols-2 gap-3">
                        <div className="bg-slate-800 rounded p-2">
                            <p className="text-xs text-gray-400">Total Orders</p>
                            <p className="text-lg font-bold text-white">{history.totalOrders}</p>
                        </div>
                        <div className="bg-slate-800 rounded p-2">
                            <p className="text-xs text-gray-400">Total Spent</p>
                            <p className="text-lg font-bold text-teal-400">{history.totalSpent}</p>
                        </div>
                        <div className="bg-slate-800 rounded p-2">
                            <p className="text-xs text-gray-400">Complaints</p>
                            <p className="text-lg font-bold text-white">{history.complaints}</p>
                        </div>
                        <div className="bg-slate-800 rounded p-2">
                            <p className="text-xs text-gray-400">Joined</p>
                            <p className="text-sm font-medium text-white">{history.joinedDate}</p>
                        </div>
                    </div>
                </div>
            );
        };

        // Internal Notes Component
        const InternalNotes = ({ conversationId }) => {
            const { conversations, setConversations } = useContext(AppContext);
            const [noteText, setNoteText] = useState('');
            
            const conversation = conversations.find(c => c.id === conversationId);
            const notes = conversation?.notes || [];

            const handleAddNote = () => {
                if (noteText.trim()) {
                    const newNote = {
                        id: Date.now(),
                        text: noteText,
                        timestamp: new Date().toLocaleString(),
                        author: "You"
                    };
                    
                    const updatedConversations = conversations.map(conv => {
                        if (conv.id === conversationId) {
                            return { ...conv, notes: [...(conv.notes || []), newNote] };
                        }
                        return conv;
                    });
                    
                    setConversations(updatedConversations);
                    setNoteText('');
                }
            };

            const handleDeleteNote = (noteId) => {
                const updatedConversations = conversations.map(conv => {
                    if (conv.id === conversationId) {
                        return { ...conv, notes: conv.notes.filter(n => n.id !== noteId) };
                    }
                    return conv;
                });
                setConversations(updatedConversations);
            };

            return (
                <div className="bg-slate-700 rounded-lg p-4 mb-4">
                    <h4 className="text-sm font-semibold text-white mb-3 flex items-center">
                        <i className="fas fa-sticky-note mr-2 text-yellow-400"></i>
                        Internal Notes
                    </h4>
                    
                    <div className="space-y-2 mb-3 max-h-40 overflow-y-auto">
                        {notes.length === 0 ? (
                            <p className="text-xs text-gray-400 italic">No notes yet</p>
                        ) : (
                            notes.map(note => (
                                <div key={note.id} className="bg-slate-800 rounded p-2 text-xs">
                                    <div className="flex justify-between items-start mb-1">
                                        <span className="text-teal-400 font-medium">{note.author}</span>
                                        <button 
                                            onClick={() => handleDeleteNote(note.id)}
                                            className="text-gray-400 hover:text-red-400 transition"
                                        >
                                            <i className="fas fa-times"></i>
                                        </button>
                                    </div>
                                    <p className="text-gray-300">{note.text}</p>
                                    <p className="text-gray-500 mt-1">{note.timestamp}</p>
                                </div>
                            ))
                        )}
                    </div>
                    
                    <div className="flex space-x-2">
                        <input
                            type="text"
                            value={noteText}
                            onChange={(e) => setNoteText(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && handleAddNote()}
                            placeholder="Add a private note..."
                            className="flex-1 px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white text-xs focus:outline-none focus:ring-2 focus:ring-yellow-500"
                        />
                        <button
                            onClick={handleAddNote}
                            className="bg-yellow-500 hover:bg-yellow-600 text-slate-900 px-3 py-2 rounded transition"
                        >
                            <i className="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
            );
        };

        // Conversation Tags Component
        const ConversationTags = ({ conversationId }) => {
            const { conversations, setConversations } = useContext(AppContext);
            const [showTagInput, setShowTagInput] = useState(false);
            const [newTag, setNewTag] = useState('');
            
            const conversation = conversations.find(c => c.id === conversationId);
            const tags = conversation?.tags || [];

            const predefinedTags = ["Urgent", "Follow-up", "VIP Customer", "Callback Required", "Resolved"];

            const handleAddTag = (tag) => {
                if (!tags.includes(tag)) {
                    const updatedConversations = conversations.map(conv => {
                        if (conv.id === conversationId) {
                            return { ...conv, tags: [...(conv.tags || []), tag] };
                        }
                        return conv;
                    });
                    setConversations(updatedConversations);
                }
                setNewTag('');
                setShowTagInput(false);
            };

            const handleRemoveTag = (tagToRemove) => {
                const updatedConversations = conversations.map(conv => {
                    if (conv.id === conversationId) {
                        return { ...conv, tags: conv.tags.filter(t => t !== tagToRemove) };
                    }
                    return conv;
                });
                setConversations(updatedConversations);
            };

            const getTagColor = (tag) => {
                const colors = {
                    "Urgent": "bg-red-500",
                    "Follow-up": "bg-blue-500",
                    "VIP Customer": "bg-purple-500",
                    "Callback Required": "bg-orange-500",
                    "Resolved": "bg-green-500"
                };
                return colors[tag] || "bg-gray-500";
            };

            return (
                <div className="mb-4">
                    <div className="flex items-center justify-between mb-2">
                        <h4 className="text-sm font-semibold text-white flex items-center">
                            <i className="fas fa-tags mr-2 text-teal-400"></i>
                            Tags
                        </h4>
                        <button
                            onClick={() => setShowTagInput(!showTagInput)}
                            className="text-xs text-teal-400 hover:text-teal-300 transition"
                        >
                            <i className="fas fa-plus mr-1"></i>Add Tag
                        </button>
                    </div>
                    
                    <div className="flex flex-wrap gap-2 mb-3">
                        {tags.length === 0 ? (
                            <span className="text-xs text-gray-400 italic">No tags</span>
                        ) : (
                            tags.map((tag, idx) => (
                                <span
                                    key={idx}
                                    className={`tag-badge ${getTagColor(tag)} text-white text-xs px-2 py-1 rounded-full flex items-center space-x-1`}
                                >
                                    <span>{tag}</span>
                                    <button
                                        onClick={() => handleRemoveTag(tag)}
                                        className="hover:bg-black hover:bg-opacity-20 rounded-full w-4 h-4 flex items-center justify-center"
                                    >
                                        <i className="fas fa-times text-xs"></i>
                                    </button>
                                </span>
                            ))
                        )}
                    </div>

                    {showTagInput && (
                        <div className="bg-slate-700 rounded-lg p-3">
                            <p className="text-xs text-gray-400 mb-2">Quick Tags:</p>
                            <div className="flex flex-wrap gap-2 mb-3">
                                {predefinedTags.filter(t => !tags.includes(t)).map((tag, idx) => (
                                    <button
                                        key={idx}
                                        onClick={() => handleAddTag(tag)}
                                        className="text-xs bg-slate-600 hover:bg-slate-500 text-white px-2 py-1 rounded transition"
                                    >
                                        {tag}
                                    </button>
                                ))}
                            </div>
                            <div className="flex space-x-2">
                                <input
                                    type="text"
                                    value={newTag}
                                    onChange={(e) => setNewTag(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && newTag.trim() && handleAddTag(newTag.trim())}
                                    placeholder="Custom tag..."
                                    className="flex-1 px-3 py-2 bg-slate-800 border border-slate-600 rounded text-white text-xs focus:outline-none focus:ring-2 focus:ring-teal-500"
                                />
                                <button
                                    onClick={() => newTag.trim() && handleAddTag(newTag.trim())}
                                    className="bg-teal-500 hover:bg-teal-600 text-white px-3 py-2 rounded transition text-xs"
                                >
                                    Add
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Chat Panel Component
        const ChatPanel = ({ conversation }) => {
            const { setSelectedConversation } = useContext(AppContext);
            const [messages, setMessages] = useState(conversation.chat);
            const [replyText, setReplyText] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const chatEndRef = useRef(null);

            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            const handleSendReply = (e) => {
                e.preventDefault();
                if (replyText.trim()) {
                    setMessages([...messages, {
                        sender: 'business',
                        message: replyText,
                        time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })
                    }]);
                    setReplyText('');
                }
            };

            const handleAISuggestReply = () => {
                setIsGenerating(true);
                
                // Simulate AI generation
                setTimeout(() => {
                    const lastCustomerMessage = [...messages].reverse().find(m => m.sender === 'customer');
                    let suggestedReply = "Thank you for contacting us. How can I assist you today?";
                    
                    if (lastCustomerMessage) {
                        const msg = lastCustomerMessage.message.toLowerCase();
                        if (msg.includes('order') && msg.includes('arrive')) {
                            suggestedReply = "Your order is being processed and should arrive within 3-5 business days. You'll receive a tracking number via WhatsApp once it ships. Is there anything else I can help you with?";
                        } else if (msg.includes('installation') || msg.includes('help')) {
                            suggestedReply = "I'd be happy to help you with the installation! Could you let me know which product you need assistance with? I can guide you through the process step by step.";
                        } else if (msg.includes('quality') || msg.includes('complaint')) {
                            suggestedReply = "I sincerely apologize for the quality issue you've experienced. This is not the standard we aim for. Could you please share more details and photos if possible? I'll ensure we resolve this immediately.";
                        } else if (msg.includes('blue') || msg.includes('color')) {
                            suggestedReply = "Yes, we have that item available in blue! Would you like me to check the current stock and pricing for you?";
                        } else if (msg.includes('bulk')) {
                            suggestedReply = "Great! We offer special pricing for bulk orders. Could you tell me the quantity you're looking for? I'll prepare a customized quote for you right away.";
                        }
                    }
                    
                    setReplyText(suggestedReply);
                    setIsGenerating(false);
                }, 1500);
            };

            return (
                <div className="bg-slate-800 rounded-xl border border-slate-700 flex flex-col h-full">
                    {/* Chat Header */}
                    <div className="p-4 border-b border-slate-700">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-3">
                                <div className="w-10 h-10 rounded-full bg-teal-500 flex items-center justify-center text-white font-semibold">
                                    {conversation.name.charAt(0)}
                                </div>
                                <div>
                                    <h3 className="font-semibold text-white">{conversation.name}</h3>
                                    <p className="text-xs text-gray-400">{conversation.number}</p>
                                </div>
                            </div>
                            <button
                                onClick={() => setSelectedConversation(null)}
                                className="w-8 h-8 rounded-full bg-slate-700 hover:bg-slate-600 flex items-center justify-center text-gray-400 hover:text-white transition"
                                title="Close chat"
                            >
                                <i className="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    {/* Chat Messages */}
                    <div className="flex-1 overflow-y-auto p-4 space-y-4">
                        {messages.map((msg, idx) => (
                            <div key={idx} className={`flex ${msg.sender === 'customer' ? 'justify-start' : 'justify-end'}`}>
                                <div className={`max-w-xs lg:max-w-md ${
                                    msg.sender === 'customer' 
                                        ? 'bg-slate-700' 
                                        : msg.sender === 'ai' 
                                        ? 'bg-purple-600' 
                                        : 'bg-teal-600'
                                } rounded-lg p-3`}>
                                    {msg.sender === 'ai' && (
                                        <div className="flex items-center space-x-1 mb-1">
                                            <i className="fas fa-robot text-xs"></i>
                                            <span className="text-xs font-medium">AI Reply</span>
                                        </div>
                                    )}
                                    <p className="text-sm text-white">{msg.message}</p>
                                    <p className="text-xs text-gray-300 mt-1">{msg.time}</p>
                                </div>
                            </div>
                        ))}
                        <div ref={chatEndRef} />
                    </div>

                    {/* Reply Box */}
                    <form onSubmit={handleSendReply} className="p-4 border-t border-slate-700">
                        <div className="flex space-x-2 mb-2">
                            <button
                                type="button"
                                onClick={handleAISuggestReply}
                                disabled={isGenerating}
                                className="bg-purple-600 hover:bg-purple-700 disabled:bg-purple-800 text-white px-4 py-2 rounded-lg transition text-sm font-medium flex items-center space-x-2"
                            >
                                {isGenerating ? (
                                    <>
                                        <i className="fas fa-spinner fa-spin"></i>
                                        <span>Generating...</span>
                                    </>
                                ) : (
                                    <>
                                        <i className="fas fa-magic"></i>
                                        <span>AI Suggest Reply</span>
                                    </>
                                )}
                            </button>
                        </div>
                        <div className="flex space-x-2">
                            <input
                                type="text"
                                value={replyText}
                                onChange={(e) => setReplyText(e.target.value)}
                                placeholder="Type your message..."
                                className="flex-1 px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white text-sm"
                            />
                            <button
                                type="submit"
                                className="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg transition"
                            >
                                <i className="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </form>
                </div>
            );
        };

        // Dashboard Screen
        const DashboardScreen = () => {
            const { selectedConversation, setSelectedConversation, conversations, searchQuery, setSearchQuery } = useContext(AppContext);
            const [activeFilter, setActiveFilter] = useState('All');
            const [templates, setTemplates] = useState([
                "Hello! Thanks for contacting us. How can I help you today?",
                "Your order has been confirmed and will be delivered soon.",
                "We're sorry for the inconvenience. Let me help you resolve this.",
                "Thank you for your patience. I'll get back to you shortly.",
                "Is there anything else I can assist you with today?"
            ]);
            const [newTemplate, setNewTemplate] = useState('');

            const filters = ['All', 'Inquiries', 'Orders', 'Complaints', 'Pending', 'Replied'];

            const getCategoryColor = (category) => {
                const colors = {
                    'Orders': 'bg-blue-500',
                    'Inquiries': 'bg-purple-500',
                    'Complaints': 'bg-red-500'
                };
                return colors[category] || 'bg-gray-500';
            };

            const filteredConversations = conversations.filter(conv => {
                const matchesFilter = activeFilter === 'All' || 
                    (activeFilter === 'Pending' || activeFilter === 'Replied' ? 
                        conv.status === activeFilter.toLowerCase() : 
                        conv.category === activeFilter);
                
                const matchesSearch = searchQuery === '' || 
                    conv.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    conv.number.includes(searchQuery);
                
                return matchesFilter && matchesSearch;
            });

            const handleSaveTemplate = () => {
                if (newTemplate.trim()) {
                    setTemplates([...templates, newTemplate]);
                    setNewTemplate('');
                }
            };

            const handleUseTemplate = (template) => {
                // This will be used when a conversation is selected
                if (selectedConversation) {
                    // In a real app, this would populate the reply box in the chat panel
                    alert(`Template copied: "${template}"`);
                }
            };

            const gridCols = selectedConversation 
                ? 'grid-cols-1 lg:grid-cols-[300px_1fr_320px]' 
                : 'grid-cols-1 lg:grid-cols-3';

            return (
                <div className={`grid ${gridCols} gap-6`}>
                    {/* Conversations List Panel */}
                    <div className={selectedConversation ? 'lg:col-span-1' : 'lg:col-span-2'}>
                        <div className="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
                            {/* Search Bar */}
                            <div className="p-4 border-b border-slate-700">
                                <div className="relative">
                                    <input
                                        type="text"
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        placeholder="Search by name or number..."
                                        className="w-full pl-10 pr-4 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white text-sm"
                                    />
                                    <i className="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                    {searchQuery && (
                                        <button
                                            onClick={() => setSearchQuery('')}
                                            className="absolute right-3 top-3 text-gray-400 hover:text-white"
                                        >
                                            <i className="fas fa-times"></i>
                                        </button>
                                    )}
                                </div>
                            </div>

                            {/* Filters */}
                            <div className="p-4 border-b border-slate-700 overflow-x-auto">
                                <div className="flex space-x-2 min-w-max">
                                    {filters.map(filter => (
                                        <button
                                            key={filter}
                                            onClick={() => setActiveFilter(filter)}
                                            className={`px-4 py-2 rounded-lg text-sm font-medium transition ${
                                                activeFilter === filter
                                                    ? 'bg-teal-500 text-white'
                                                    : 'bg-slate-700 text-gray-400 hover:bg-slate-600'
                                            }`}
                                        >
                                            {filter}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            {/* Conversations Table */}
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-slate-700">
                                        <tr>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Customer</th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase hidden md:table-cell">Last Message</th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Category</th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Time</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-700">
                                        {filteredConversations.length === 0 ? (
                                            <tr>
                                                <td colSpan="4" className="px-4 py-8 text-center text-gray-400">
                                                    <i className="fas fa-inbox text-3xl mb-2"></i>
                                                    <p>No conversations found</p>
                                                </td>
                                            </tr>
                                        ) : (
                                            filteredConversations.map(conv => (
                                                <tr 
                                                    key={conv.id} 
                                                    onClick={() => setSelectedConversation(conv)}
                                                    className={`cursor-pointer transition ${
                                                        selectedConversation?.id === conv.id 
                                                            ? 'bg-slate-700' 
                                                            : 'hover:bg-slate-700'
                                                    }`}
                                                >
                                                    <td className="px-4 py-4">
                                                        <div>
                                                            <div className="font-medium text-white flex items-center">
                                                                {conv.name}
                                                                {conv.tags && conv.tags.length > 0 && (
                                                                    <span className="ml-2 text-xs text-teal-400">
                                                                        <i className="fas fa-tags"></i>
                                                                    </span>
                                                                )}
                                                            </div>
                                                            <div className="text-xs text-gray-400">{conv.number}</div>
                                                        </div>
                                                    </td>
                                                    <td className="px-4 py-4 hidden md:table-cell">
                                                        <div className="flex items-center space-x-2">
                                                            {conv.aiReplied && <i className="fas fa-robot text-teal-400 text-xs"></i>}
                                                            <span className="text-sm text-gray-300">{conv.lastMessage}</span>
                                                        </div>
                                                    </td>
                                                    <td className="px-4 py-4">
                                                        <span className={`px-2 py-1 text-xs font-medium text-white rounded-full ${getCategoryColor(conv.category)}`}>
                                                            {conv.category}
                                                        </span>
                                                    </td>
                                                    <td className="px-4 py-4 text-sm text-gray-400">{conv.timestamp}</td>
                                                </tr>
                                            ))
                                        )}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    {/* Chat Panel (Middle Column) */}
                    {selectedConversation && (
                        <div className="lg:col-span-1 chat-container">
                            <ChatPanel conversation={selectedConversation} />
                        </div>
                    )}

                    {/* Right Sidebar - Customer Info & Templates */}
                    <div className="lg:col-span-1">
                        {selectedConversation && (
                            <div className="space-y-4 mb-4">
                                <CustomerHistory history={selectedConversation.customerHistory} />
                                <div className="bg-slate-800 rounded-xl border border-slate-700 p-4">
                                    <ConversationTags conversationId={selectedConversation.id} />
                                    <InternalNotes conversationId={selectedConversation.id} />
                                </div>
                            </div>
                        )}

                        <div className="bg-slate-800 rounded-xl border border-slate-700 p-6">
                            <h3 className="text-lg font-semibold text-white mb-4 flex items-center">
                                <i className="fas fa-bolt mr-2 text-teal-400"></i>
                                Quick Replies
                            </h3>
                            
                            <div className="space-y-2 mb-6 max-h-64 overflow-y-auto">
                                {templates.map((template, index) => (
                                    <button
                                        key={index}
                                        onClick={() => handleUseTemplate(template)}
                                        className="w-full bg-slate-700 hover:bg-slate-600 p-3 rounded-lg text-sm text-gray-300 text-left transition group"
                                    >
                                        <div className="flex items-start justify-between">
                                            <span className="flex-1">{template}</span>
                                            <i className="fas fa-copy text-teal-400 opacity-0 group-hover:opacity-100 transition ml-2"></i>
                                        </div>
                                    </button>
                                ))}
                            </div>

                            <div>
                                <textarea
                                    value={newTemplate}
                                    onChange={(e) => setNewTemplate(e.target.value)}
                                    placeholder="Type a new template..."
                                    className="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white text-sm mb-3 resize-none"
                                    rows="3"
                                />
                                <button 
                                    onClick={handleSaveTemplate}
                                    className="w-full bg-teal-500 hover:bg-teal-600 text-white font-medium py-2 rounded-lg transition"
                                >
                                    <i className="fas fa-save mr-2"></i>
                                    Save Template
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Analytics Screen
        const AnalyticsScreen = () => {
            const chartRef = useRef(null);
            const chartInstanceRef = useRef(null);

            const stats = [
                { icon: 'fas fa-envelope', label: 'Total Messages Handled', value: '1,247', color: 'bg-blue-500' },
                { icon: 'fas fa-robot', label: 'AI vs Manual Replies', value: '78% AI', color: 'bg-purple-500' },
                { icon: 'fas fa-clock', label: 'Avg. Response Time', value: '2.5 min', color: 'bg-teal-500' },
                { icon: 'fas fa-inbox', label: 'New Inquiries Today', value: '34', color: 'bg-orange-500' }
            ];

            useEffect(() => {
                if (chartRef.current) {
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.destroy();
                    }

                    const ctx = chartRef.current.getContext('2d');
                    
                    chartInstanceRef.current = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Inquiries', 'Orders', 'Complaints', 'Other'],
                            datasets: [{
                                label: 'Message Distribution',
                                data: [385, 456, 201, 205],
                                backgroundColor: [
                                    'rgba(168, 85, 247, 0.8)',
                                    'rgba(59, 130, 246, 0.8)',
                                    'rgba(239, 68, 68, 0.8)',
                                    'rgba(107, 114, 128, 0.8)'
                                ],
                                borderColor: [
                                    'rgba(168, 85, 247, 1)',
                                    'rgba(59, 130, 246, 1)',
                                    'rgba(239, 68, 68, 1)',
                                    'rgba(107, 114, 128, 1)'
                                ],
                                borderWidth: 2
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: '#d1d5db',
                                        font: {
                                            size: 12,
                                            family: 'Inter'
                                        },
                                        padding: 20
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(15, 23, 42, 0.9)',
                                    titleColor: '#fff',
                                    bodyColor: '#d1d5db',
                                    borderColor: '#334155',
                                    borderWidth: 1,
                                    padding: 12,
                                    displayColors: true,
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed || 0;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = ((value / total) * 100).toFixed(1);
                                            return `${label}: ${value} (${percentage}%)`;
                                        }
                                    }
                                }
                            },
                            animation: {
                                animateRotate: true,
                                animateScale: true,
                                duration: 1500
                            }
                        }
                    });
                }

                return () => {
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.destroy();
                    }
                };
            }, []);

            return (
                <div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        {stats.map((stat, index) => (
                            <div key={index} className="bg-slate-800 rounded-xl border border-slate-700 p-6">
                                <div className={`${stat.color} w-12 h-12 rounded-lg flex items-center justify-center mb-4`}>
                                    <i className={`${stat.icon} text-white text-xl`}></i>
                                </div>
                                <h3 className="text-2xl font-bold text-white mb-1">{stat.value}</h3>
                                <p className="text-sm text-gray-400">{stat.label}</p>
                            </div>
                        ))}
                    </div>

                    <div className="bg-slate-800 rounded-xl border border-slate-700 p-6">
                        <h3 className="text-lg font-semibold text-white mb-4">Message Distribution</h3>
                        <div className="h-80">
                            <canvas ref={chartRef}></canvas>
                        </div>
                    </div>
                </div>
            );
        };

        // Settings Screen
        const SettingsScreen = () => {
            const { userData } = useContext(AuthContext);
            const { setAuthState } = useContext(AuthContext);
            const [settings, setSettings] = useState({
                businessName: userData.businessName || '',
                email: 'user@example.com',
                language: userData.language || 'English',
                autoReply: true
            });

            const handleSave = (e) => {
                e.preventDefault();
                alert('Settings saved successfully!');
            };

            return (
                <div className="max-w-2xl">
                    <div className="bg-slate-800 rounded-xl border border-slate-700 p-6">
                        <h2 className="text-2xl font-bold text-white mb-6">Profile & Settings</h2>

                        <form onSubmit={handleSave}>
                            <div className="mb-4">
                                <label className="block text-gray-300 text-sm font-medium mb-2">Business Name</label>
                                <input 
                                    type="text" 
                                    value={settings.businessName}
                                    onChange={(e) => setSettings({...settings, businessName: e.target.value})}
                                    className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white"
                                />
                            </div>

                            <div className="mb-4">
                                <label className="block text-gray-300 text-sm font-medium mb-2">Email</label>
                                <input 
                                    type="email" 
                                    value={settings.email}
                                    readOnly
                                    className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg text-gray-500 cursor-not-allowed"
                                />
                            </div>

                            <div className="mb-4">
                                <label className="block text-gray-300 text-sm font-medium mb-2">Language Preference</label>
                                <select 
                                    value={settings.language}
                                    onChange={(e) => setSettings({...settings, language: e.target.value})}
                                    className="w-full px-4 py-3 bg-slate-700 border border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-white"
                                >
                                    <option>English</option>
                                    <option>Hindi</option>
                                </select>
                            </div>

                            <div className="mb-6 flex items-center justify-between bg-slate-700 px-4 py-3 rounded-lg">
                                <span className="text-gray-300 font-medium">Enable Auto-Reply</span>
                                <button 
                                    type="button"
                                    onClick={() => setSettings({...settings, autoReply: !settings.autoReply})}
                                    className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${settings.autoReply ? 'bg-teal-500' : 'bg-gray-600'}`}
                                >
                                    <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${settings.autoReply ? 'translate-x-6' : 'translate-x-1'}`} />
                                </button>
                            </div>

                            <div className="flex space-x-4">
                                <button 
                                    type="submit"
                                    className="flex-1 bg-teal-500 hover:bg-teal-600 text-white font-semibold py-3 rounded-lg transition"
                                >
                                    Save Changes
                                </button>
                                <button 
                                    type="button"
                                    onClick={() => setAuthState(null)}
                                    className="flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-3 rounded-lg transition"
                                >
                                    Logout
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // Main Application Layout
        const MainApp = () => {
            const { activeScreen } = useContext(AppContext);

            return (
                <div className="flex h-screen bg-slate-900">
                    <Sidebar />
                    
                    <div className="flex-1 flex flex-col lg:ml-64">
                        <Header />
                        
                        <main className="flex-1 overflow-y-auto p-4 lg:p-6 pb-20 lg:pb-6">
                            {activeScreen === 'dashboard' && <DashboardScreen />}
                            {activeScreen === 'analytics' && <AnalyticsScreen />}
                            {activeScreen === 'settings' && <SettingsScreen />}
                        </main>
                    </div>

                    <BottomNav />
                </div>
            );
        };

        // Root App Component
        const App = () => {
            const { authState } = useContext(AuthContext);

            return (
                <>
                    {authState === null && <LoginScreen />}
                    {authState === 'onboarding' && <OnboardingScreen />}
                    {authState === 'loggedIn' && <MainApp />}
                </>
            );
        };

        // Render App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <AuthProvider>
                <AppProvider>
                    <App />
                </AppProvider>
            </AuthProvider>
        );
    </script>
</body>
</html>